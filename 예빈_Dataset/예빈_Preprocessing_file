import pandas as pd
from scipy import stats

df = pd.read_csv("예빈_Dataset/4_예빈.py.csv")

missing_values = df.isnull().sum()
missing_values = missing_values[missing_values > 0]


print(missing_values)

# 중복 제거 (PatientId 기준)
df_no_duplicates = df.drop_duplicates(subset=['PatientId'])

# 이상치 제거 (Z-score 이용)
score_cols = ['Age']
z_scores = stats.zscore(df[score_cols])

# Z-score 절댓값이 3 미만인 행만 남김
df = df[(np.abs(z_scores) < 3).all(axis=1)]


# Label Encoding
label_cols = ['Gender', 'Scholarship', 'Hipertension', 'Diabetes', 'Alcoholism', 'Handcap', 'SMS_received', 'No-show']
for col in label_cols:
    le = LabelEncoder()
    df[col] = le.fit_transform(df[col])

    
# One-Hot Encoding
df_encoded = pd.get_dummies(df, columns=['Neighbourhood'])

#날짜 전처리
df['ScheduledDay'] = pd.to_datetime(df['ScheduledDay'])
df['AppointmentDay'] = pd.to_datetime(df['AppointmentDay'])
df['ScheduledDay_weekday'] = df['ScheduledDay'].dt.dayofweek
df['AppointmentDay_weekday'] = df['AppointmentDay'].dt.dayofweek

df_encoded.to_csv("예빈_Preprocessed_dataset/4번_예빈.py.csv", index=False)
